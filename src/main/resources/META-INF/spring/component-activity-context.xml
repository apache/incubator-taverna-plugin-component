<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:osgi="http://www.springframework.org/schema/osgi"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/osgi http://www.springframework.org/schema/osgi/spring-osgi.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/beans/spring-util.xsd">
	<context:annotation-config />

	<bean id="prefs" class="net.sf.taverna.t2.component.preference.ComponentPreference">
		<constructor-arg name="cm" ref="configManager" />
		<constructor-arg name="factory" ref="componentFactory" />
	</bean>
	<bean id="preferencePanel" class="net.sf.taverna.t2.component.ui.preference.ComponentPreferencePanel">
		<constructor-arg name="componentFactory" ref="componentFactory" />
		<constructor-arg name="preferences" ref="prefs" />
	</bean>
	<bean id="componentSupport"
		class="net.sf.taverna.t2.component.ui.menu.component.ComponentCreatorSupport">
		<property name="componentFactory" ref="componentFactory" />
		<property name="preferences" ref="prefs" />
		<property name="fileManager" ref="fileManager" />
		<property name="editManager" ref="editManager" />
	</bean>


<!-- === Service description provider === -->
<bean id="componentServiceProvider"
	class="net.sf.taverna.t2.component.ui.serviceprovider.ComponentServiceProvider" />
<osgi:service ref="componentServiceProvider" auto-export="interfaces" />

<!-- === Icon === -->
<bean id="icon" class="net.sf.taverna.t2.component.ui.serviceprovider.ComponentServiceIcon" />
<osgi:service ref="icon" interface="net.sf.taverna.t2.workbench.activityicons.ActivityIconSPI" />

<!-- === Startup === -->
<osgi:service interface="net.sf.taverna.t2.workbench.StartupSPI">
	<bean class="net.sf.taverna.t2.component.ui.file.FileManagerObserver">
		<property name="colours" /><!-- FIXME -->
		<property name="fileManager" ref="fileManager" />
		<property name="graphView" /><!-- FIXME -->
	</bean>
</osgi:service>

<!-- === Dataflow persistence handlers === -->
<osgi:service interface="net.sf.taverna.t2.workbench.file.DataflowPersistenceHandler">
	<bean class="net.sf.taverna.t2.component.ui.file.ComponentOpener">
		<property name="componentFactory" ref="componentFactory" />
	</bean>
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.workbench.file.DataflowPersistenceHandler">
	<bean class="net.sf.taverna.t2.component.ui.file.ComponentSaver">
		<property name="componentFactory" ref="componentFactory" />
	</bean>
</osgi:service>

<!-- === Health checkers === -->
<osgi:service interface="net.sf.taverna.t2.workflowmodel.health.HealthChecker">
	<bean class="net.sf.taverna.t2.component.ui.file.ComponentDataflowHealthChecker">
		<property name="componentFactory" ref="componentFactory" />
		<property name="fileManager" ref="fileManager" />
	</bean>
</osgi:service>

<!-- === Configuration UI factories === -->
<bean id="componentConfigurationUI"
		class="net.sf.taverna.t2.component.ui.preference.ComponentPreferenceUIFactory">
	<property name="preferences" ref="prefs" />
	<property name="configPanel" ref="preferencePanel" />
</bean>

<!-- === Context view factories === -->
<bean id="componentActivityContextView"
	class="net.sf.taverna.t2.component.ui.view.ComponentActivityContextViewFactory" />
<bean id="componentContextView"
	class="net.sf.taverna.t2.component.ui.view.ComponentContextViewFactory" />
<bean id="componentActivitySemanticAnnotationContextView"
	class="net.sf.taverna.t2.component.ui.view.ComponentActivitySemanticAnnotationContextViewFactory" />
<bean id="semanticAnnotationContextView"
	class="net.sf.taverna.t2.component.annotation.SemanticAnnotationContextualViewFactory" />

<!-- === Menu actions === -->
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
<bean id="componentConfigureMenuAction"
	class="net.sf.taverna.t2.component.ui.menu.ComponentConfigureMenuAction" />
</osgi:service>
<!-- don't publish --><bean id="componentServiceCreatorMenuAction"
	class="net.sf.taverna.t2.component.ui.menu.component.ComponentServiceCreatorMenuAction" />
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
<bean id="nestedWorkflowCreatorMenuAction"
	class="net.sf.taverna.t2.component.ui.menu.NestedWorkflowCreatorMenuAction" />
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
<bean id="replaceByComponentMenuAction"
	class="net.sf.taverna.t2.component.ui.menu.ReplaceByComponentMenuAction" />
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
<bean id="openComponentFromComponentActivityMenuAction"
	class="net.sf.taverna.t2.component.ui.menu.OpenComponentFromComponentActivityMenuAction" />
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
<bean id="componentMenu"
	class="net.sf.taverna.t2.component.ui.menu.ComponentMenu" />
</osgi:service>

<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<bean
		class="net.sf.taverna.t2.component.ui.menu.registry.ComponentRegistryMenuSection" />
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
<bean id="componentRegistryManageMenuAction"
	class="net.sf.taverna.t2.component.ui.menu.registry.ComponentRegistryManageMenuAction" />
</osgi:service>

<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<bean
		class="net.sf.taverna.t2.component.ui.menu.profile.ComponentProfileMenuSection" />
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
<bean id="componentProfileImportMenuAction"
	class="net.sf.taverna.t2.component.ui.menu.profile.ComponentProfileImportMenuAction" />
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
<bean id="componentProfileCopyMenuAction"
	class="net.sf.taverna.t2.component.ui.menu.profile.ComponentProfileCopyMenuAction" />
</osgi:service>

<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<bean
		class="net.sf.taverna.t2.component.ui.menu.family.ComponentFamilyMenuSection" />
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="componentFamilyCreateAction" />
	</osgi:service-properties>
	<bean id="componentFamilyCreateMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.family.ComponentFamilyCreateMenuAction">
		<property name="preferences" ref="prefs" />
	</bean>
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="componentFamilyDeleteAction" />
	</osgi:service-properties>
	<bean id="componentFamilyDeleteMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.family.ComponentFamilyDeleteMenuAction">
		<property name="fileManager" ref="fileManager" />
		<property name="preferences" ref="prefs" />
	</bean>
</osgi:service>

<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<bean
		class="net.sf.taverna.t2.component.ui.menu.component.ComponentMenuSection" />
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="componentCreateAction" />
	</osgi:service-properties>
	<bean id="componentWorkflowCreatorMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.component.ComponentWorkflowCreatorMenuAction">
		<property name="fileManager" ref="fileManager" />
		<property name="support" ref="componentSupport" />
	</bean>
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="componentOpenAction" />
	</osgi:service-properties>
	<bean id="fileOpenFromComponentMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.component.FileOpenFromComponentMenuAction">
		<property name="fileManager" ref="fileManager" />
		<property name="preferences" ref="prefs" />
	</bean>
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="componentCopyAction" />
	</osgi:service-properties>
	<bean id="componentCopyMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.component.ComponentCopyMenuAction">
		<property name="preferences" ref="prefs" />
	</bean>
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="componentDeleteAction" />
	</osgi:service-properties>
	<bean id="componentDeleteMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.component.ComponentDeleteMenuAction">
		<property name="fileManager" ref="fileManager" />
		<property name="preferences" ref="prefs" />
	</bean>
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="componentMergeAction" />
	</osgi:service-properties>
	<bean id="componentMergeMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.component.ComponentMergeMenuAction">
		<property name="preferences" ref="prefs" />
	</bean>
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="componentCloseAction" />
	</osgi:service-properties>
	<bean id="componentCloseMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.component.ComponentCloseMenuAction">
		<property name="closeWorkflowAction"><!-- FIXME net.sf.taverna.t2.workbench.file.impl.actions.CloseWorkflowAction --></property>
		<property name="fileManager" ref="fileManager" />
	</bean>
</osgi:service>
<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="componentSaveAction" />
	</osgi:service-properties>
	<bean id="componentSaveMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.component.ComponentSaveMenuAction">
		<property name="saveWorkflowAction"><!-- FIXME net.sf.taverna.t2.workbench.file.impl.actions.SaveWorkflowAction --></property>
		<property name="fileManager" ref="fileManager" />
	</bean>
</osgi:service>
	<bean id="componentSearchMenuAction"
		class="net.sf.taverna.t2.component.ui.menu.component.ComponentSearchMenuAction">
		<!-- don't publish -->
		<property name="componentFactory" ref="componentFactory" />
		<property name="editManager" ref="editManager" />
		<property name="menuManager"><!-- FIXME --></property>
		<property name="preferences" ref="prefs" />
		<property name="selectionManager"><!-- FIXME --></property>
		<property name="serviceRegistry"><!-- FIXME --></property>
	</bean>

<osgi:service interface="net.sf.taverna.t2.ui.menu.MenuComponent">
	<osgi:service-properties>
		<entry key="name" value="annotateSemanticsAction" />
	</osgi:service-properties>
	<bean id="annotateSemanticsMenuAction"
		class="net.sf.taverna.t2.component.annotation.AnnotateSemanticsMenuAction">
		<property name="componentFactory" ref="componentFactory" />
		<property name="fileManager" ref="fileManager" />
	</bean>
</osgi:service>

<!-- 
	<bean id="ComponentLocalHealthChecker"
		class="net.sf.taverna.t2.component.ComponentActivityLocalChecker" />
	<bean id="ComponentUpgradeHealthChecker"
		class="net.sf.taverna.t2.component.ComponentActivityUpgradeChecker">
		<property name="componentUtil" ref="componentUtil" />
	</bean>
	<bean id="baseProfileLocator" class="net.sf.taverna.t2.component.profile.BaseProfileLocator">
		<property name="appConfig" ref="app-config" />
	</bean>

	<bean id="componentActivityFactory" class="net.sf.taverna.t2.component.ComponentActivityFactory">
		<property name="componentUtil" ref="componentUtil" />
		<property name="dataflowCache" ref="cache" />
		<property name="edits" ref="edits" />
		<property name="annotationUtils" ref="annotationUtil" />
	</bean>

	<bean id="networkRegistry"
		class="net.sf.taverna.t2.component.registry.standard.NewComponentRegistryFactory">
		<property name="credentialManager" ref="credentialManager" />
		<property name="componentUtil" ref="componentUtil" />
		<property name="systemUtils" ref="systemUtil" />
		<property name="annotationUtils" ref="annotationUtil" />
	</bean>
	<bean id="fileRegistry"
		class="net.sf.taverna.t2.component.registry.local.LocalComponentRegistryFactory">
		<property name="componentUtil" ref="componentUtil" />
		<property name="systemUtils" ref="systemUtil" />
	</bean>
	<bean id="componentUtil" class="net.sf.taverna.t2.component.registry.ComponentUtil">
		<property name="networkLocator" ref="networkRegistry" />
		<property name="fileLocator" ref="fileRegistry" />
		<property name="baseLocator" ref="baseProfileLocator" />
	</bean>

	<bean id="cache" class="net.sf.taverna.t2.component.registry.ComponentImplementationCache">
		<property name="componentUtil" ref="componentUtil" />
	</bean>
	<bean id="systemUtil" class="net.sf.taverna.t2.component.utils.SystemUtils">
		<property name="appConfig" ref="app-config" />
		<property name="workflowBundler" ref="workflowBundleIO" />
		<property name="compilers" ref="compilers" />
	</bean>
	<bean id="annotationUtil" class="net.sf.taverna.t2.component.utils.AnnotationUtils" />

	<osgi:service ref="ComponentLocalHealthChecker"
		interface="net.sf.taverna.t2.workflowmodel.health.HealthChecker" />
	<osgi:service ref="ComponentUpgradeHealthChecker"
		interface="net.sf.taverna.t2.workflowmodel.health.HealthChecker" />
	<osgi:service ref="componentActivityFactory"
		interface="net.sf.taverna.t2.workflowmodel.processor.activity.ActivityFactory" />
	<osgi:service ref="componentUtil"
		interface="net.sf.taverna.t2.component.api.ComponentFactory" />

	<osgi:reference id="app-config"
		interface="uk.org.taverna.configuration.app.ApplicationConfiguration" />
	<osgi:reference id="credentialManager"
		interface="net.sf.taverna.t2.security.credentialmanager.CredentialManager" />
	<osgi:reference id="edits" interface="net.sf.taverna.t2.workflowmodel.Edits" />
	<osgi:reference id="workflowBundleIO" interface="uk.org.taverna.scufl2.api.io.WorkflowBundleIO" />
	<osgi:list id="compilers" interface="uk.org.taverna.platform.execution.api.WorkflowCompiler" />
 -->
 	<osgi:reference id="editManager" interface="net.sf.taverna.t2.workbench.edits.EditManager" />
 	<osgi:reference id="fileManager" interface="net.sf.taverna.t2.workbench.file.FileManager" />
 	<osgi:reference id="configManager" interface="uk.org.taverna.configuration.ConfigurationManager" />
 	<osgi:reference id="componentFactory" interface="net.sf.taverna.t2.component.api.ComponentFactory" />
</beans>
